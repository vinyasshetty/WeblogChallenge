{"paragraphs":[{"text":"import org.apache.spark.sql.types._\nimport org.apache.spark.sql.expressions.Window\nimport org.apache.spark.sql.expressions.MutableAggregationBuffer\nimport org.apache.spark.sql.expressions.UserDefinedAggregateFunction\nimport org.apache.spark.sql.Row","user":"anonymous","dateUpdated":"2020-03-26T01:51:19+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.types._\nimport org.apache.spark.sql.expressions.Window\nimport org.apache.spark.sql.expressions.MutableAggregationBuffer\nimport org.apache.spark.sql.expressions.UserDefinedAggregateFunction\nimport org.apache.spark.sql.Row\n"}]},"apps":[],"jobName":"paragraph_1585187369285_1718326554","id":"20200322-153507_1852679785","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:169","dateFinished":"2020-03-26T01:51:20+0000","dateStarted":"2020-03-26T01:51:19+0000"},{"text":"spark.version","user":"anonymous","dateUpdated":"2020-03-26T01:51:20+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res7: String = 2.4.4\n"}]},"apps":[],"jobName":"paragraph_1585187369289_567066378","id":"20200325-022426_333368311","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:170","dateFinished":"2020-03-26T01:51:20+0000","dateStarted":"2020-03-26T01:51:20+0000"},{"text":" val sch = StructType.fromDDL(\"\"\"ts string,\n elb_name string,\n request_ip string,\n backend_ip string,\n request_processing_time double,\n backend_processing_time double,\n client_response_time double,\n elb_response_code string,\n backend_response_code string,\n received_bytes bigint,\n sent_bytes bigint,\n request string,\n user_agent string,\n ssl_cipher string,\n ssl_protocol string\"\"\")\n\nval raw_data = spark.read.schema(sch).option(\"delimiter\",\" \").csv(\"s3://paytmviny/inp_data/2015_07_22_mktplace_shop_web_log_sample.log.gz\")\n","user":"anonymous","dateUpdated":"2020-03-26T01:51:20+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sch: org.apache.spark.sql.types.StructType = StructType(StructField(ts,StringType,true), StructField(elb_name,StringType,true), StructField(request_ip,StringType,true), StructField(backend_ip,StringType,true), StructField(request_processing_time,DoubleType,true), StructField(backend_processing_time,DoubleType,true), StructField(client_response_time,DoubleType,true), StructField(elb_response_code,StringType,true), StructField(backend_response_code,StringType,true), StructField(received_bytes,LongType,true), StructField(sent_bytes,LongType,true), StructField(request,StringType,true), StructField(user_agent,StringType,true), StructField(ssl_cipher,StringType,true), StructField(ssl_protocol,StringType,true))\nraw_data: org.apache.spark.sql.DataFrame = [ts: string, elb_name: string ... 13 mor..."}]},"apps":[],"jobName":"paragraph_1585187369290_2141479441","id":"20200322-153557_49416566","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:171","dateFinished":"2020-03-26T01:51:21+0000","dateStarted":"2020-03-26T01:51:20+0000"},{"text":"val wndw = Window.partitionBy(\"clientip\").orderBy($\"ts\")\n\n/*\n    val std_data = raw_data.select(\n      $\"ts\".as(\"ts_string\"),\n      regexp_replace($\"ts\",\"T\",\" \").as(\"ts_str_new\"),\n      unix_timestamp($\"ts\", \"yyyy-MM-dd'T'HH:mm:ss\").cast(\"timestamp\").as(\"ts_timestamp\"),\n      $\"ts\".cast(\"timestamp\").as(\"ts_dir_timestamp\"),\n\n      // date_format($\"ts\".cast(\"timestamp\"), \"yyyy-MM-dd HH:mm:ss\").cast(\"timestamp\").as(\"ts_new\"),\n      // split($\"request_ip\",\":\")(0).as(\"clientip\"),split($\"request\",\" \")(1).as(\"url\"),\n      $\"elb_response_code\")\n*/\n/*\n    Extracted IP and excluded the ports from request_ip column\n    Extracted only the URL from request.\n    Using lag functions populated a column :prevts for every client, will use this for generating sessionid later\n    Also generated a new column called timediff which will have the time difference(in mins) for every client between their two\n    consecutive occurences.Thier first apperance record will have a 0. Casted this to Decimal(12,4). Had faced precsion issues with\n    double and also using lower precision of decimal.\n*/ \n\n val std_data = raw_data.select(\n                                  //date_format($\"ts\".cast(\"timestamp\"), \"yyyy-MM-dd HH:mm:ss\").cast(\"timestamp\").as(\"ts\"),\n                                // unix_timestamp($\"ts\", \"yyyy-MM-dd'T'HH:mm:ss\").cast(\"timestamp\").as(\"ts\"),\n                                  $\"ts\".cast(\"timestamp\").as(\"ts\"),\n                                 split($\"request_ip\",\":\")(0).as(\"clientip\"),\n                                  split($\"request\",\" \")(1).as(\"url\"),\n                                  $\"elb_response_code\")\n                           .withColumn(\"prevts\", lag($\"ts\",1).over(wndw))\n                           .withColumn(\"timediff\", when($\"prevts\".isNull,0).otherwise(($\"ts\".cast(\"decimal(18,6)\") - $\"prevts\".cast(\"decimal(18,6)\"))/60.0).cast(\"decimal(38,10)\"))\n                          \n  ","user":"anonymous","dateUpdated":"2020-03-26T01:51:21+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"wndw: org.apache.spark.sql.expressions.WindowSpec = org.apache.spark.sql.expressions.WindowSpec@5002eff0\nstd_data: org.apache.spark.sql.DataFrame = [ts: timestamp, clientip: string ... 4 more fields]\n"}]},"apps":[],"jobName":"paragraph_1585187369290_404902603","id":"20200322-153627_2068722820","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:172","dateFinished":"2020-03-26T01:51:21+0000","dateStarted":"2020-03-26T01:51:21+0000"},{"text":"//std_data.select($\"ts_string\",$\"ts_str_new\",$\"ts_timestamp\",$\"ts_dir_timestamp\").show(false)","user":"anonymous","dateUpdated":"2020-03-26T01:51:21+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585187369290_-1974087641","id":"20200322-175306_733594644","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:173","dateFinished":"2020-03-26T01:51:21+0000","dateStarted":"2020-03-26T01:51:21+0000"},{"text":"//std_data.filter(!(substring($\"ts_str_new\",1,19) <=> $\"ts_new\".cast(\"string\"))).select($\"ts\",$\"ts_string\",$\"ts_new\",$\"ts_str_new\").show(false)","user":"anonymous","dateUpdated":"2020-03-26T01:51:21+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585187369291_1357592911","id":"20200322-175710_803900482","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:174","dateFinished":"2020-03-26T01:51:22+0000","dateStarted":"2020-03-26T01:51:22+0000"},{"text":"//std_data.filter(substring($\"ts_str_new\",1,19) <=> $\"ts_new\".cast(\"string\")).count","user":"anonymous","dateUpdated":"2020-03-26T01:51:22+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585187369291_-1203250126","id":"20200322-180108_633165126","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:175","dateFinished":"2020-03-26T01:51:22+0000","dateStarted":"2020-03-26T01:51:22+0000"},{"text":"std_data.count","user":"anonymous","dateUpdated":"2020-03-26T01:51:22+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res14: Long = 1158500\n"}]},"apps":[],"jobName":"paragraph_1585187369291_725442297","id":"20200322-153941_197820887","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:176","dateFinished":"2020-03-26T01:51:34+0000","dateStarted":"2020-03-26T01:51:22+0000"},{"text":"std_data.printSchema","user":"anonymous","dateUpdated":"2020-03-26T01:51:34+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- ts: timestamp (nullable = true)\n |-- clientip: string (nullable = true)\n |-- url: string (nullable = true)\n |-- elb_response_code: string (nullable = true)\n |-- prevts: timestamp (nullable = true)\n |-- timediff: decimal(38,10) (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1585187369292_-680399118","id":"20200322-153950_2026587508","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:177","dateFinished":"2020-03-26T01:51:34+0000","dateStarted":"2020-03-26T01:51:34+0000"},{"text":"std_data.show(2,false)","user":"anonymous","dateUpdated":"2020-03-26T01:51:35+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------------+------------+-----------------------------------------------------+-----------------+--------------------------+------------+\n|ts                        |clientip    |url                                                  |elb_response_code|prevts                    |timediff    |\n+--------------------------+------------+-----------------------------------------------------+-----------------+--------------------------+------------+\n|2015-07-22 16:14:36.308131|1.186.143.37|https://paytm.com:443/                               |200              |null                      |0E-10       |\n|2015-07-22 16:14:44.846873|1.186.143.37|https://paytm.com:443/shop/cart?channel=web&version=2|200              |2015-07-22 16:14:36.308131|0.1423123667|\n+--------------------------+------------+-----------------------------------------------------+-----------------+--------------------------+------------+\nonly showing top 2 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585187369292_-254795166","id":"20200322-160853_1037376424","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:178","dateFinished":"2020-03-26T01:51:48+0000","dateStarted":"2020-03-26T01:51:35+0000"},{"text":"std_data.filter($\"clientip\" <=> \"112.196.25.164\").orderBy($\"ts\".desc).show(100,false)","user":"anonymous","dateUpdated":"2020-03-26T01:51:48+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------------+--------------+-----------------------------------------------------------------+-----------------+--------------------------+------------+\n|ts                        |clientip      |url                                                              |elb_response_code|prevts                    |timediff    |\n+--------------------------+--------------+-----------------------------------------------------------------+-----------------+--------------------------+------------+\n|2015-07-22 21:10:27.914275|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:27.776193|0.0023013667|\n|2015-07-22 21:10:27.776193|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:27.642779|0.0022235667|\n|2015-07-22 21:10:27.642779|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:27.504975|0.0022967333|\n|2015-07-22 21:10:27.504975|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:27.363374|0.0023600167|\n|2015-07-22 21:10:27.363374|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:27.160719|0.0033775833|\n|2015-07-22 21:10:27.160719|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:27.020051|0.0023444667|\n|2015-07-22 21:10:27.020051|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:26.884441|0.0022601667|\n|2015-07-22 21:10:26.884441|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:26.745964|0.0023079500|\n|2015-07-22 21:10:26.745964|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:26.608985|0.0022829833|\n|2015-07-22 21:10:26.608985|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:26.468049|0.0023489333|\n|2015-07-22 21:10:26.468049|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:26.328685|0.0023227333|\n|2015-07-22 21:10:26.328685|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:26.166648|0.0027006167|\n|2015-07-22 21:10:26.166648|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:26.02729 |0.0023226333|\n|2015-07-22 21:10:26.02729 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:25.890675|0.0022769167|\n|2015-07-22 21:10:25.890675|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:25.75175 |0.0023154167|\n|2015-07-22 21:10:25.75175 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:25.615224|0.0022754333|\n|2015-07-22 21:10:25.615224|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:25.479061|0.0022693833|\n|2015-07-22 21:10:25.479061|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:25.341014|0.0023007833|\n|2015-07-22 21:10:25.341014|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:25.203625|0.0022898167|\n|2015-07-22 21:10:25.203625|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:25.060607|0.0023836333|\n|2015-07-22 21:10:25.060607|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:24.919649|0.0023493000|\n|2015-07-22 21:10:24.919649|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:24.784474|0.0022529167|\n|2015-07-22 21:10:24.784474|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:24.645484|0.0023165000|\n|2015-07-22 21:10:24.645484|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:24.506668|0.0023136000|\n|2015-07-22 21:10:24.506668|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:24.364617|0.0023675167|\n|2015-07-22 21:10:24.364617|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:24.225244|0.0023228833|\n|2015-07-22 21:10:24.225244|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:24.085388|0.0023309333|\n|2015-07-22 21:10:24.085388|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:23.94916 |0.0022704667|\n|2015-07-22 21:10:23.94916 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:23.813009|0.0022691833|\n|2015-07-22 21:10:23.813009|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:23.599039|0.0035661667|\n|2015-07-22 21:10:23.599039|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:23.384941|0.0035683000|\n|2015-07-22 21:10:23.384941|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:23.241298|0.0023940500|\n|2015-07-22 21:10:23.241298|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:23.102181|0.0023186167|\n|2015-07-22 21:10:23.102181|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:22.961506|0.0023445833|\n|2015-07-22 21:10:22.961506|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:22.81962 |0.0023647667|\n|2015-07-22 21:10:22.81962 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:22.682962|0.0022776333|\n|2015-07-22 21:10:22.682962|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:22.544937|0.0023004167|\n|2015-07-22 21:10:22.544937|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:22.407389|0.0022924667|\n|2015-07-22 21:10:22.407389|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:22.269434|0.0022992500|\n|2015-07-22 21:10:22.269434|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:22.132144|0.0022881667|\n|2015-07-22 21:10:22.132144|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:21.989403|0.0023790167|\n|2015-07-22 21:10:21.989403|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:21.850299|0.0023184000|\n|2015-07-22 21:10:21.850299|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:21.713104|0.0022865833|\n|2015-07-22 21:10:21.713104|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:21.564274|0.0024805000|\n|2015-07-22 21:10:21.564274|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:21.428092|0.0022697000|\n|2015-07-22 21:10:21.428092|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:21.289887|0.0023034167|\n|2015-07-22 21:10:21.289887|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:21.149263|0.0023437333|\n|2015-07-22 21:10:21.149263|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:21.00853 |0.0023455500|\n|2015-07-22 21:10:21.00853 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:20.871953|0.0022762833|\n|2015-07-22 21:10:20.871953|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:20.732794|0.0023193167|\n|2015-07-22 21:10:20.732794|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:20.59687 |0.0022654000|\n|2015-07-22 21:10:20.59687 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:20.457887|0.0023163833|\n|2015-07-22 21:10:20.457887|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:20.321906|0.0022663500|\n|2015-07-22 21:10:20.321906|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:20.154564|0.0027890333|\n|2015-07-22 21:10:20.154564|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:20.013571|0.0023498833|\n|2015-07-22 21:10:20.013571|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:19.876808|0.0022793833|\n|2015-07-22 21:10:19.876808|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:19.737885|0.0023153833|\n|2015-07-22 21:10:19.737885|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:19.600309|0.0022929333|\n|2015-07-22 21:10:19.600309|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:19.461739|0.0023095000|\n|2015-07-22 21:10:19.461739|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:19.325347|0.0022732000|\n|2015-07-22 21:10:19.325347|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:19.158728|0.0027769833|\n|2015-07-22 21:10:19.158728|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:19.018453|0.0023379167|\n|2015-07-22 21:10:19.018453|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:18.88254 |0.0022652167|\n|2015-07-22 21:10:18.88254 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:18.746249|0.0022715167|\n|2015-07-22 21:10:18.746249|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:18.603683|0.0023761000|\n|2015-07-22 21:10:18.603683|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:18.462875|0.0023468000|\n|2015-07-22 21:10:18.462875|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:18.322209|0.0023444333|\n|2015-07-22 21:10:18.322209|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:18.186877|0.0022555333|\n|2015-07-22 21:10:18.186877|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:18.048073|0.0023134000|\n|2015-07-22 21:10:18.048073|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:17.905343|0.0023788333|\n|2015-07-22 21:10:17.905343|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:17.764729|0.0023435667|\n|2015-07-22 21:10:17.764729|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:17.625059|0.0023278333|\n|2015-07-22 21:10:17.625059|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:17.487965|0.0022849000|\n|2015-07-22 21:10:17.487965|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:17.348585|0.0023230000|\n|2015-07-22 21:10:17.348585|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:17.209303|0.0023213667|\n|2015-07-22 21:10:17.209303|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:17.064732|0.0024095167|\n|2015-07-22 21:10:17.064732|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:16.927467|0.0022877500|\n|2015-07-22 21:10:16.927467|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:16.787146|0.0023386833|\n|2015-07-22 21:10:16.787146|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:16.651261|0.0022647500|\n|2015-07-22 21:10:16.651261|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:16.512654|0.0023101167|\n|2015-07-22 21:10:16.512654|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:16.369796|0.0023809667|\n|2015-07-22 21:10:16.369796|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:16.228294|0.0023583667|\n|2015-07-22 21:10:16.228294|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:16.087734|0.0023426667|\n|2015-07-22 21:10:16.087734|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:15.952749|0.0022497500|\n|2015-07-22 21:10:15.952749|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:15.810274|0.0023745833|\n|2015-07-22 21:10:15.810274|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:15.671747|0.0023087833|\n|2015-07-22 21:10:15.671747|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:15.531402|0.0023390833|\n|2015-07-22 21:10:15.531402|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:15.38671 |0.0024115333|\n|2015-07-22 21:10:15.38671 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:15.248808|0.0022983667|\n|2015-07-22 21:10:15.248808|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:15.109296|0.0023252000|\n|2015-07-22 21:10:15.109296|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:14.968284|0.0023502000|\n|2015-07-22 21:10:14.968284|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:14.82941 |0.0023145667|\n|2015-07-22 21:10:14.82941 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:14.691491|0.0022986500|\n|2015-07-22 21:10:14.691491|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:14.55066 |0.0023471833|\n|2015-07-22 21:10:14.55066 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:14.410015|0.0023440833|\n|2015-07-22 21:10:14.410015|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:14.273705|0.0022718333|\n|2015-07-22 21:10:14.273705|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:14.136157|0.0022924667|\n|2015-07-22 21:10:14.136157|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:14.00012 |0.0022672833|\n|2015-07-22 21:10:14.00012 |112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:13.865292|0.0022471333|\n|2015-07-22 21:10:13.865292|112.196.25.164|https://paytm.com:443/bus-tickets/search/Delhi/Katra/2015-07-31/1|200              |2015-07-22 21:10:13.725868|0.0023237333|\n+--------------------------+--------------+-----------------------------------------------------------------+-----------------+--------------------------+------------+\nonly showing top 100 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585187369292_-1674716001","id":"20200325-042441_191504743","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:179","dateFinished":"2020-03-26T01:51:57+0000","dateStarted":"2020-03-26T01:51:48+0000"},{"text":"std_data.filter($\"timediff\".isNull).show(false)","user":"anonymous","dateUpdated":"2020-03-26T01:51:57+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+--------+---+-----------------+------+--------+\n|ts |clientip|url|elb_response_code|prevts|timediff|\n+---+--------+---+-----------------+------+--------+\n+---+--------+---+-----------------+------+--------+\n\n"}]},"apps":[],"jobName":"paragraph_1585187369293_-1647987255","id":"20200322-164127_2029436726","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:180","dateFinished":"2020-03-26T01:52:15+0000","dateStarted":"2020-03-26T01:51:57+0000"},{"text":"import java.math.BigDecimal\nclass SessionUDAF(val windowTime:BigDecimal) extends UserDefinedAggregateFunction {\n  def deterministic: Boolean = true\n  def inputSchema: StructType = StructType(Array(StructField(\"timediff\", DecimalType(18,6))))\n  def dataType: DataType = IntegerType\n  \n\n  def bufferSchema = StructType(Array(\n    StructField(\"id\", IntegerType),\n    StructField(\"smcnt\", DecimalType(18,6))\n  ))\n\n  def initialize(buffer: MutableAggregationBuffer) = {\n    buffer(0) = 0\n    buffer(1) = new BigDecimal(\"0.0\")\n  }\n\n  def update(buffer: MutableAggregationBuffer, input: Row) = { \n      if((buffer.getAs[BigDecimal](1).add(input.getAs[BigDecimal](0))).compareTo(windowTime) <= 0){\n          buffer(1) = buffer.getAs[BigDecimal](1).add(input.getAs[BigDecimal](0)) \n\n      }\n      else if((buffer.getAs[BigDecimal](1).add(input.getAs[BigDecimal](0))).compareTo(windowTime) > 0){\n          buffer(0) = buffer.getAs[Int](0) + 1\n          buffer(1) =  new BigDecimal(\"0.0\")\n      }\n      else{\n          throw new Exception(\"Should not be here\")\n      }\n   \n  }\n\n  def merge(buffer1: MutableAggregationBuffer, buffer2: Row) = {\n  } \n  def evaluate(buffer: Row): Int = buffer.getInt(0)\n }\n","user":"anonymous","dateUpdated":"2020-03-26T01:52:15+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import java.math.BigDecimal\ndefined class SessionUDAF\n"}]},"apps":[],"jobName":"paragraph_1585187369293_-1345733277","id":"20200322-153957_1622021358","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:181","dateFinished":"2020-03-26T01:52:15+0000","dateStarted":"2020-03-26T01:52:15+0000"},{"text":"val session_create = new SessionUDAF(new BigDecimal(\"15.0\"))","user":"anonymous","dateUpdated":"2020-03-26T01:52:15+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"session_create: SessionUDAF = SessionUDAF@30663638\n"}]},"apps":[],"jobName":"paragraph_1585187369293_-339489266","id":"20200322-154044_1353325212","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:182","dateFinished":"2020-03-26T01:52:15+0000","dateStarted":"2020-03-26T01:52:15+0000"},{"text":"std_data.show(2)","user":"anonymous","dateUpdated":"2020-03-26T01:52:15+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+------------+--------------------+-----------------+--------------------+------------+\n|                  ts|    clientip|                 url|elb_response_code|              prevts|    timediff|\n+--------------------+------------+--------------------+-----------------+--------------------+------------+\n|2015-07-22 16:14:...|1.186.143.37|https://paytm.com...|              200|                null|       0E-10|\n|2015-07-22 16:14:...|1.186.143.37|https://paytm.com...|              200|2015-07-22 16:14:...|0.1423123667|\n+--------------------+------------+--------------------+-----------------+--------------------+------------+\nonly showing top 2 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585187369293_-2049484485","id":"20200322-154100_1529672180","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:183","dateFinished":"2020-03-26T01:52:29+0000","dateStarted":"2020-03-26T01:52:16+0000"},{"text":"val new_wndw = Window.partitionBy(\"clientip\").orderBy($\"ts\",$\"timediff\".desc)\n\nval sessioned_data = std_data.select($\"*\", session_create($\"timediff\").over(new_wndw).as(\"sessionid\"))","user":"anonymous","dateUpdated":"2020-03-26T01:52:29+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"new_wndw: org.apache.spark.sql.expressions.WindowSpec = org.apache.spark.sql.expressions.WindowSpec@17cc0c28\nsessioned_data: org.apache.spark.sql.DataFrame = [ts: timestamp, clientip: string ... 5 more fields]\n"}]},"apps":[],"jobName":"paragraph_1585187369294_2065370779","id":"20200322-154149_1494551315","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:184","dateFinished":"2020-03-26T01:52:30+0000","dateStarted":"2020-03-26T01:52:29+0000"},{"text":"sessioned_data.filter($\"sessionid\".isNull).count","user":"anonymous","dateUpdated":"2020-03-26T01:52:30+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res20: Long = 0\n"}]},"apps":[],"jobName":"paragraph_1585187369294_147348795","id":"20200322-164007_1002213274","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:185","dateFinished":"2020-03-26T01:52:45+0000","dateStarted":"2020-03-26T01:52:30+0000"},{"text":"//Count still same as raw_data\nsessioned_data.count()","user":"anonymous","dateUpdated":"2020-03-26T01:52:45+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res21: Long = 1158500\n"}]},"apps":[],"jobName":"paragraph_1585187369294_2050540548","id":"20200325-020015_924564657","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:186","dateFinished":"2020-03-26T01:52:48+0000","dateStarted":"2020-03-26T01:52:45+0000"},{"text":"sessioned_data.printSchema","user":"anonymous","dateUpdated":"2020-03-26T01:52:48+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- ts: timestamp (nullable = true)\n |-- clientip: string (nullable = true)\n |-- url: string (nullable = true)\n |-- elb_response_code: string (nullable = true)\n |-- prevts: timestamp (nullable = true)\n |-- timediff: decimal(38,10) (nullable = true)\n |-- sessionid: integer (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1585187369294_1537236612","id":"20200322-154413_542850210","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:187","dateFinished":"2020-03-26T01:52:48+0000","dateStarted":"2020-03-26T01:52:48+0000"},{"text":"%md\n\n## aggregrate all page hits by visitor/IP during a session. ","user":"anonymous","dateUpdated":"2020-03-26T01:52:48+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>aggregrate all page hits by visitor/IP during a session.</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1585187369295_-970653028","id":"20200322-165122_1501476010","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:188","dateFinished":"2020-03-26T01:52:51+0000","dateStarted":"2020-03-26T01:52:48+0000"},{"text":"sessioned_data.explain(true)\n","user":"anonymous","dateUpdated":"2020-03-26T01:52:51+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"== Parsed Logical Plan ==\n'Project [*, sessionudaf('timediff, $line124472081341.$read$$iw$$iw$$iw$$iw$SessionUDAF@30663638, 0, 0) windowspecdefinition('clientip, 'ts ASC NULLS FIRST, 'timediff DESC NULLS LAST, unspecifiedframe$()) AS sessionid#228]\n+- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, cast(CASE WHEN isnull(prevts#107) THEN cast(0 as double) ELSE (cast(CheckOverflow((promote_precision(cast(cast(ts#100 as decimal(18,6)) as decimal(19,6))) - promote_precision(cast(cast(prevts#107 as decimal(18,6)) as decimal(19,6)))), DecimalType(19,6)) as double) / 60.0) END as decimal(38,10)) AS timediff#113]\n   +- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107]\n      +- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, prevts#107]\n         +- Window [lag(ts#100, 1, null) windowspecdefinition(clientip#101, ts#100 ASC NULLS FIRST, specifiedwindowframe(RowFrame, -1, -1)) AS prevts#107], [clientip#101], [ts#100 ASC NULLS FIRST]\n            +- Project [ts#100, clientip#101, url#102, elb_response_code#77]\n               +- Project [cast(ts#70 as timestamp) AS ts#100, split(request_ip#72, :)[0] AS clientip#101, split(request#81,  )[1] AS url#102, elb_response_code#77]\n                  +- Relation[ts#70,elb_name#71,request_ip#72,backend_ip#73,request_processing_time#74,backend_processing_time#75,client_response_time#76,elb_response_code#77,backend_response_code#78,received_bytes#79L,sent_bytes#80L,request#81,user_agent#82,ssl_cipher#83,ssl_protocol#84] csv\n\n== Analyzed Logical Plan ==\nts: timestamp, clientip: string, url: string, elb_response_code: string, prevts: timestamp, timediff: decimal(38,10), sessionid: int\nProject [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, timediff#113, sessionid#228]\n+- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, timediff#113, _w0#284, sessionid#228, sessionid#228]\n   +- Window [sessionudaf(_w0#284, $line124472081341.$read$$iw$$iw$$iw$$iw$SessionUDAF@30663638, 0, 0) windowspecdefinition(clientip#101, ts#100 ASC NULLS FIRST, timediff#113 DESC NULLS LAST, specifiedwindowframe(RangeFrame, unboundedpreceding$(), currentrow$())) AS sessionid#228], [clientip#101], [ts#100 ASC NULLS FIRST, timediff#113 DESC NULLS LAST]\n      +- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, timediff#113, cast(timediff#113 as decimal(18,6)) AS _w0#284]\n         +- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, cast(CASE WHEN isnull(prevts#107) THEN cast(0 as double) ELSE (cast(CheckOverflow((promote_precision(cast(cast(ts#100 as decimal(18,6)) as decimal(19,6))) - promote_precision(cast(cast(prevts#107 as decimal(18,6)) as decimal(19,6)))), DecimalType(19,6)) as double) / 60.0) END as decimal(38,10)) AS timediff#113]\n            +- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107]\n               +- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, prevts#107]\n                  +- Window [lag(ts#100, 1, null) windowspecdefinition(clientip#101, ts#100 ASC NULLS FIRST, specifiedwindowframe(RowFrame, -1, -1)) AS prevts#107], [clientip#101], [ts#100 ASC NULLS FIRST]\n                     +- Project [ts#100, clientip#101, url#102, elb_response_code#77]\n                        +- Project [cast(ts#70 as timestamp) AS ts#100, split(request_ip#72, :)[0] AS clientip#101, split(request#81,  )[1] AS url#102, elb_response_code#77]\n                           +- Relation[ts#70,elb_name#71,request_ip#72,backend_ip#73,request_processing_time#74,backend_processing_time#75,client_response_time#76,elb_response_code#77,backend_response_code#78,received_bytes#79L,sent_bytes#80L,request#81,user_agent#82,ssl_cipher#83,ssl_protocol#84] csv\n\n== Optimized Logical Plan ==\nProject [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, timediff#113, sessionid#228]\n+- Window [sessionudaf(_w0#284, $line124472081341.$read$$iw$$iw$$iw$$iw$SessionUDAF@30663638, 0, 0) windowspecdefinition(clientip#101, ts#100 ASC NULLS FIRST, timediff#113 DESC NULLS LAST, specifiedwindowframe(RangeFrame, unboundedpreceding$(), currentrow$())) AS sessionid#228], [clientip#101], [ts#100 ASC NULLS FIRST, timediff#113 DESC NULLS LAST]\n   +- Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, cast(CASE WHEN isnull(prevts#107) THEN 0.0 ELSE (cast(CheckOverflow((promote_precision(cast(cast(ts#100 as decimal(18,6)) as decimal(19,6))) - promote_precision(cast(cast(prevts#107 as decimal(18,6)) as decimal(19,6)))), DecimalType(19,6)) as double) / 60.0) END as decimal(38,10)) AS timediff#113, cast(cast(CASE WHEN isnull(prevts#107) THEN 0.0 ELSE (cast(CheckOverflow((promote_precision(cast(cast(ts#100 as decimal(18,6)) as decimal(19,6))) - promote_precision(cast(cast(prevts#107 as decimal(18,6)) as decimal(19,6)))), DecimalType(19,6)) as double) / 60.0) END as decimal(38,10)) as decimal(18,6)) AS _w0#284]\n      +- Window [lag(ts#100, 1, null) windowspecdefinition(clientip#101, ts#100 ASC NULLS FIRST, specifiedwindowframe(RowFrame, -1, -1)) AS prevts#107], [clientip#101], [ts#100 ASC NULLS FIRST]\n         +- Project [cast(ts#70 as timestamp) AS ts#100, split(request_ip#72, :)[0] AS clientip#101, split(request#81,  )[1] AS url#102, elb_response_code#77]\n            +- Relation[ts#70,elb_name#71,request_ip#72,backend_ip#73,request_processing_time#74,backend_processing_time#75,client_response_time#76,elb_response_code#77,backend_response_code#78,received_bytes#79L,sent_bytes#80L,request#81,user_agent#82,ssl_cipher#83,ssl_protocol#84] csv\n\n== Physical Plan ==\n*(4) Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, timediff#113, sessionid#228]\n+- Window [sessionudaf(_w0#284, $line124472081341.$read$$iw$$iw$$iw$$iw$SessionUDAF@30663638, 0, 0) windowspecdefinition(clientip#101, ts#100 ASC NULLS FIRST, timediff#113 DESC NULLS LAST, specifiedwindowframe(RangeFrame, unboundedpreceding$(), currentrow$())) AS sessionid#228], [clientip#101], [ts#100 ASC NULLS FIRST, timediff#113 DESC NULLS LAST]\n   +- *(3) Sort [clientip#101 ASC NULLS FIRST, ts#100 ASC NULLS FIRST, timediff#113 DESC NULLS LAST], false, 0\n      +- *(3) Project [ts#100, clientip#101, url#102, elb_response_code#77, prevts#107, cast(CASE WHEN isnull(prevts#107) THEN 0.0 ELSE (cast(CheckOverflow((promote_precision(cast(cast(ts#100 as decimal(18,6)) as decimal(19,6))) - promote_precision(cast(cast(prevts#107 as decimal(18,6)) as decimal(19,6)))), DecimalType(19,6)) as double) / 60.0) END as decimal(38,10)) AS timediff#113, cast(cast(CASE WHEN isnull(prevts#107) THEN 0.0 ELSE (cast(CheckOverflow((promote_precision(cast(cast(ts#100 as decimal(18,6)) as decimal(19,6))) - promote_precision(cast(cast(prevts#107 as decimal(18,6)) as decimal(19,6)))), DecimalType(19,6)) as double) / 60.0) END as decimal(38,10)) as decimal(18,6)) AS _w0#284]\n         +- Window [lag(ts#100, 1, null) windowspecdefinition(clientip#101, ts#100 ASC NULLS FIRST, specifiedwindowframe(RowFrame, -1, -1)) AS prevts#107], [clientip#101], [ts#100 ASC NULLS FIRST]\n            +- *(2) Sort [clientip#101 ASC NULLS FIRST, ts#100 ASC NULLS FIRST], false, 0\n               +- Exchange hashpartitioning(clientip#101, 200)\n                  +- *(1) Project [cast(ts#70 as timestamp) AS ts#100, split(request_ip#72, :)[0] AS clientip#101, split(request#81,  )[1] AS url#102, elb_response_code#77]\n                     +- *(1) FileScan csv [ts#70,request_ip#72,elb_response_code#77,request#81] Batched: false, Format: CSV, Location: InMemoryFileIndex[s3://paytmviny/inp_data/2015_07_22_mktplace_shop_web_log_sample.log.gz], PartitionFilters: [], PushedFilters: [], ReadSchema: struct<ts:string,request_ip:string,elb_response_code:string,request:string>\n"}]},"apps":[],"jobName":"paragraph_1585187369295_-1860606286","id":"20200325-020440_2081449555","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:189","dateFinished":"2020-03-26T01:52:51+0000","dateStarted":"2020-03-26T01:52:51+0000"},{"text":"sessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(count($\"*\").as(\"cnt\"),\n                   min($\"ts\").as(\"session_starttime\"),max($\"ts\").as(\"session_endtime\")).orderBy($\"cnt\".desc).show(false)\n","user":"anonymous","dateUpdated":"2020-03-26T01:52:51+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------------+-----+--------------------------+--------------------------+\n|sessionid|clientip      |cnt  |session_starttime         |session_endtime           |\n+---------+--------------+-----+--------------------------+--------------------------+\n|7        |119.81.61.166 |10540|2015-07-22 16:10:28.394091|2015-07-22 16:25:05.211263|\n|7        |52.74.219.71  |6714 |2015-07-22 16:10:28.056562|2015-07-22 16:25:05.202249|\n|4        |52.74.219.71  |6016 |2015-07-22 10:30:28.220275|2015-07-22 10:39:47.42702 |\n|11       |106.186.23.95 |5114 |2015-07-22 21:05:28.048908|2015-07-22 21:10:27.952944|\n|0        |106.51.132.54 |4399 |2015-07-22 16:10:28.051642|2015-07-22 16:14:52.013537|\n|10       |52.74.219.71  |4277 |2015-07-22 18:00:28.444086|2015-07-22 18:05:27.566212|\n|9        |119.81.61.166 |4054 |2015-07-22 17:40:28.042128|2015-07-22 17:45:28.037648|\n|11       |52.74.219.71  |3831 |2015-07-22 21:05:28.077091|2015-07-22 21:10:27.95016 |\n|10       |119.81.61.166 |3763 |2015-07-22 18:00:28.6032  |2015-07-22 18:05:27.768298|\n|9        |52.74.219.71  |3575 |2015-07-22 17:40:28.080159|2015-07-22 17:45:27.904253|\n|0        |119.81.61.166 |3429 |2015-07-22 02:40:06.77039 |2015-07-22 02:45:03.781765|\n|3        |52.74.219.71  |3090 |2015-07-22 09:00:28.348141|2015-07-22 09:04:43.352165|\n|11       |119.81.61.166 |2987 |2015-07-22 21:05:28.042763|2015-07-22 21:10:27.654732|\n|8        |119.81.61.166 |2891 |2015-07-22 16:40:28.222688|2015-07-22 16:44:48.462751|\n|5        |52.74.219.71  |2842 |2015-07-22 10:45:28.320258|2015-07-22 10:49:52.557803|\n|8        |52.74.219.71  |2753 |2015-07-22 16:40:28.370059|2015-07-22 16:44:48.434167|\n|6        |52.74.219.71  |2751 |2015-07-22 11:00:28.722157|2015-07-22 11:04:57.382184|\n|1        |52.74.219.71  |2295 |2015-07-22 05:10:07.342661|2015-07-22 05:15:07.066653|\n|2        |54.169.20.106 |1979 |2015-07-22 16:10:29.567476|2015-07-22 16:24:03.20708 |\n|1        |112.196.25.164|1946 |2015-07-22 17:40:28.116902|2015-07-22 17:45:27.894465|\n+---------+--------------+-----+--------------------------+--------------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585187369295_79510327","id":"20200322-174100_2033103511","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:190","dateFinished":"2020-03-26T01:53:05+0000","dateStarted":"2020-03-26T01:52:51+0000"},{"text":"//Same as above but in ascending order\nsessioned_data.groupBy($\"sessionid\",$\"clientip\").agg(count($\"*\").as(\"cnt\")).orderBy($\"cnt\".asc).show()","user":"anonymous","dateUpdated":"2020-03-26T01:53:05+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+---------------+---+\n|sessionid|       clientip|cnt|\n+---------+---------------+---+\n|        0|   103.5.132.66|  1|\n|        0|115.242.231.230|  1|\n|        0|106.192.157.103|  1|\n|        0| 103.242.63.141|  1|\n|        0|106.208.171.179|  1|\n|        0|   1.23.135.159|  1|\n|        0| 106.208.45.219|  1|\n|        0|     1.23.2.244|  1|\n|        0|  106.220.11.54|  1|\n|        0|     1.39.32.75|  1|\n|        0|106.221.132.100|  1|\n|        0|    1.39.61.239|  1|\n|        0|  106.51.133.30|  1|\n|        2|    1.39.61.239|  1|\n|        0|   106.51.52.85|  1|\n|        1|     1.39.13.57|  1|\n|        0|  106.77.35.248|  1|\n|        0|  101.2.111.190|  1|\n|        2|107.167.107.129|  1|\n|        0|101.221.135.200|  1|\n+---------+---------------+---+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585187369295_-1694979717","id":"20200322-160037_1872931807","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:191","dateFinished":"2020-03-26T01:53:19+0000","dateStarted":"2020-03-26T01:53:05+0000"},{"text":"%md \n\n## Determine the average session time","user":"anonymous","dateUpdated":"2020-03-26T01:53:19+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Determine the average session time</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1585187369296_990430302","id":"20200322-164735_903520815","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:192","dateFinished":"2020-03-26T01:53:19+0000","dateStarted":"2020-03-26T01:53:19+0000"},{"text":"sessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(((max($\"ts\").cast(\"decimal(18,6)\")-min($\"ts\").cast(\"decimal(18,6)\"))/60.0).cast(\"decimal(18,6)\").as(\"sessiontime\"))\n              .select(avg($\"sessiontime\").as(\"avgsession(in mins)\")).show()\n","user":"anonymous","dateUpdated":"2020-03-26T01:53:19+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------+\n|avgsession(in mins)|\n+-------------------+\n|       1.4907047352|\n+-------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1585187369296_2119122009","id":"20200325-032111_1792926039","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:193","dateFinished":"2020-03-26T01:53:32+0000","dateStarted":"2020-03-26T01:53:19+0000"},{"text":"// AVG SESSION TIME Per Client\nsessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(((max($\"ts\").cast(\"decimal(18,6)\")-min($\"ts\").cast(\"decimal(18,6)\"))/60.0).cast(\"decimal(18,6)\").as(\"sessiontime\"))\n              .groupBy($\"clientip\")\n              .agg(avg($\"sessiontime\").as(\"avgsessionperclient(in mins)\"), count($\"*\").as(\"numsessionperclient\")).orderBy($\"avgsessionperclient(in mins)\".desc).show()\n","user":"anonymous","dateUpdated":"2020-03-26T01:53:32+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------------+----------------------------+-------------------+\n|       clientip|avgsessionperclient(in mins)|numsessionperclient|\n+---------------+----------------------------+-------------------+\n|   14.99.239.11|               14.9958460000|                  1|\n| 122.169.109.88|               14.9954140000|                  1|\n| 14.139.126.167|               14.9899340000|                  1|\n| 136.185.242.32|               14.9893890000|                  1|\n| 125.99.121.178|               14.9877090000|                  1|\n|220.227.161.206|               14.9867660000|                  2|\n|  182.66.46.104|               14.9733090000|                  1|\n| 183.82.106.197|               14.9708070000|                  1|\n|202.191.244.122|               14.9680410000|                  1|\n|112.133.233.120|               14.9643130000|                  1|\n|  202.87.35.226|               14.9608120000|                  2|\n|106.206.129.105|               14.9567780000|                  1|\n|     27.7.80.60|               14.9553280000|                  1|\n|115.246.163.140|               14.9496330000|                  1|\n|180.151.225.122|               14.9437650000|                  1|\n| 219.91.201.190|               14.9353420000|                  1|\n|   61.1.158.105|               14.9297960000|                  1|\n|  117.204.51.10|               14.9253850000|                  1|\n|   27.109.27.26|               14.9211560000|                  1|\n|   27.7.204.104|               14.9159060000|                  1|\n+---------------+----------------------------+-------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585187369296_-851656477","id":"20200322-165237_1973404284","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:194","dateFinished":"2020-03-26T01:53:46+0000","dateStarted":"2020-03-26T01:53:32+0000"},{"text":"// Cross Verification\n//Number of Sessions\nprintln(sessioned_data.groupBy($\"sessionid\",$\"clientip\").agg(max(lit(1)).as(\"dummy\")).count())\n\n//Total Sum of Session Time\nsessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(((max($\"ts\").cast(\"decimal(18,6)\")-min($\"ts\").cast(\"decimal(18,6)\"))/60.0).cast(\"decimal(18,6)\").as(\"sessiontime\"))\n              .select(sum($\"sessiontime\")).show()","user":"anonymous","dateUpdated":"2020-03-26T01:53:46+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"113375\n+----------------+\n|sum(sessiontime)|\n+----------------+\n|   169008.649356|\n+----------------+\n\n"}]},"apps":[],"jobName":"paragraph_1585187369297_-1392708891","id":"20200322-171251_960520752","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:195","dateFinished":"2020-03-26T01:54:10+0000","dateStarted":"2020-03-26T01:53:46+0000"},{"text":"169008.649356/113375","user":"anonymous","dateUpdated":"2020-03-26T01:54:11+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res29: Double = 1.4907047352238147\n"}]},"apps":[],"jobName":"paragraph_1585187369297_745508263","id":"20200322-171446_1138931943","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:196","dateFinished":"2020-03-26T01:54:11+0000","dateStarted":"2020-03-26T01:54:11+0000"},{"text":"%md \n\n## Determine unique URL visits per session. To clarify, count a hit to a unique URL only once per session.","user":"anonymous","dateUpdated":"2020-03-26T01:54:11+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Determine unique URL visits per session. To clarify, count a hit to a unique URL only once per session.</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1585187369297_-790360199","id":"20200322-171654_576783534","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:197","dateFinished":"2020-03-26T01:54:11+0000","dateStarted":"2020-03-26T01:54:11+0000"},{"text":"sessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(min($\"ts\").as(\"session_starttime\"),max($\"ts\").as(\"session_endtime\"),countDistinct($\"url\").as(\"distincturlpersession\"))\n              .orderBy($\"distincturlpersession\".desc).show(false)","user":"anonymous","dateUpdated":"2020-03-26T01:54:11+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-------------+--------------------------+--------------------------+---------------------+\n|sessionid|clientip     |session_starttime         |session_endtime           |distincturlpersession|\n+---------+-------------+--------------------------+--------------------------+---------------------+\n|7        |119.81.61.166|2015-07-22 16:10:28.394091|2015-07-22 16:25:05.211263|8016                 |\n|7        |52.74.219.71 |2015-07-22 16:10:28.056562|2015-07-22 16:25:05.202249|5478                 |\n|4        |52.74.219.71 |2015-07-22 10:30:28.220275|2015-07-22 10:39:47.42702 |5057                 |\n|11       |106.186.23.95|2015-07-22 21:05:28.048908|2015-07-22 21:10:27.952944|4656                 |\n|9        |119.81.61.166|2015-07-22 17:40:28.042128|2015-07-22 17:45:28.037648|3928                 |\n|10       |119.81.61.166|2015-07-22 18:00:28.6032  |2015-07-22 18:05:27.768298|3637                 |\n|0        |119.81.61.166|2015-07-22 02:40:06.77039 |2015-07-22 02:45:03.781765|3334                 |\n|10       |52.74.219.71 |2015-07-22 18:00:28.444086|2015-07-22 18:05:27.566212|2907                 |\n|11       |119.81.61.166|2015-07-22 21:05:28.042763|2015-07-22 21:10:27.654732|2841                 |\n|8        |119.81.61.166|2015-07-22 16:40:28.222688|2015-07-22 16:44:48.462751|2786                 |\n|0        |106.51.132.54|2015-07-22 16:10:28.051642|2015-07-22 16:14:52.013537|2609                 |\n|3        |52.74.219.71 |2015-07-22 09:00:28.348141|2015-07-22 09:04:43.352165|2572                 |\n|5        |52.74.219.71 |2015-07-22 10:45:28.320258|2015-07-22 10:49:52.557803|2569                 |\n|9        |52.74.219.71 |2015-07-22 17:40:28.080159|2015-07-22 17:45:27.904253|2535                 |\n|11       |52.74.219.71 |2015-07-22 21:05:28.077091|2015-07-22 21:10:27.95016 |2466                 |\n|8        |52.74.219.71 |2015-07-22 16:40:28.370059|2015-07-22 16:44:48.434167|2458                 |\n|1        |52.74.219.71 |2015-07-22 05:10:07.342661|2015-07-22 05:15:07.066653|2037                 |\n|6        |52.74.219.71 |2015-07-22 11:00:28.722157|2015-07-22 11:04:57.382184|1958                 |\n|2        |54.169.20.106|2015-07-22 16:10:29.567476|2015-07-22 16:24:03.20708 |1896                 |\n|2        |119.81.61.166|2015-07-22 06:55:07.896678|2015-07-22 07:00:07.059378|1671                 |\n+---------+-------------+--------------------------+--------------------------+---------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585187369297_-1660095909","id":"20200322-171752_413971544","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:198","dateFinished":"2020-03-26T01:54:28+0000","dateStarted":"2020-03-26T01:54:11+0000"},{"text":"%md \n\n## Find the most engaged users, ie the IPs with the longest session times","user":"anonymous","dateUpdated":"2020-03-26T01:54:28+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Find the most engaged users, ie the IPs with the longest session times</h2>\n</div>"}]},"apps":[],"jobName":"paragraph_1585187369298_-718383784","id":"20200322-172359_990971536","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:199","dateFinished":"2020-03-26T01:54:28+0000","dateStarted":"2020-03-26T01:54:28+0000"},{"text":"//Users who are most engaged based on session time\nsessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(((max($\"ts\").cast(\"decimal(18,6)\")-min($\"ts\").cast(\"decimal(18,6)\"))/60.0).cast(\"decimal(18,6)\").as(\"sessiontime\"),\n                    min($\"ts\").as(\"session_starttime\"),max($\"ts\").as(\"session_endtime\"))\n              .orderBy($\"sessiontime\".desc).show(100,false)","user":"anonymous","dateUpdated":"2020-03-26T01:54:28+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+---------------+-----------+--------------------------+--------------------------+\n|sessionid|clientip       |sessiontime|session_starttime         |session_endtime           |\n+---------+---------------+-----------+--------------------------+--------------------------+\n|0        |117.199.107.47 |14.999949  |2015-07-22 10:48:09.498826|2015-07-22 11:03:09.495755|\n|4        |125.19.44.66   |14.999932  |2015-07-22 10:30:28.187923|2015-07-22 10:45:28.183869|\n|0        |112.133.246.6  |14.999881  |2015-07-22 10:33:55.985465|2015-07-22 10:48:55.978351|\n|1        |203.99.211.133 |14.999864  |2015-07-22 10:47:30.202734|2015-07-22 11:02:30.194579|\n|0        |1.186.101.79   |14.999862  |2015-07-22 10:45:55.881199|2015-07-22 11:00:55.872936|\n|4        |121.242.40.15  |14.999835  |2015-07-22 10:46:16.840687|2015-07-22 11:01:16.830805|\n|1        |119.235.50.12  |14.999808  |2015-07-22 10:30:50.063207|2015-07-22 10:45:50.051669|\n|1        |59.160.139.117 |14.999804  |2015-07-22 10:30:47.70931 |2015-07-22 10:45:47.697543|\n|1        |123.63.47.173  |14.999640  |2015-07-22 10:34:25.749231|2015-07-22 10:49:25.727605|\n|2        |122.248.183.22 |14.999540  |2015-07-22 10:30:36.009126|2015-07-22 10:45:35.981527|\n|0        |125.16.58.78   |14.999484  |2015-07-22 10:45:45.92667 |2015-07-22 11:00:45.895707|\n|0        |117.200.4.141  |14.999393  |2015-07-22 10:47:34.6296  |2015-07-22 11:02:34.593185|\n|0        |125.19.34.86   |14.999168  |2015-07-22 10:30:36.849368|2015-07-22 10:45:36.799455|\n|1        |111.118.248.24 |14.999123  |2015-07-22 10:34:11.537803|2015-07-22 10:49:11.485166|\n|0        |117.215.157.146|14.999106  |2015-07-22 10:31:23.858163|2015-07-22 10:46:23.804526|\n|7        |116.50.79.74   |14.998996  |2015-07-22 16:09:51.726939|2015-07-22 16:24:51.66669 |\n|2        |203.89.152.131 |14.998981  |2015-07-22 10:32:03.576763|2015-07-22 10:47:03.51563 |\n|4        |103.27.171.49  |14.998929  |2015-07-22 10:49:52.259798|2015-07-22 11:04:52.19552 |\n|1        |103.29.159.186 |14.998862  |2015-07-22 10:30:29.284428|2015-07-22 10:45:29.21614 |\n|1        |117.217.94.18  |14.998674  |2015-07-22 10:49:40.518687|2015-07-22 11:04:40.439132|\n|4        |59.160.73.118  |14.998670  |2015-07-22 10:45:59.155741|2015-07-22 11:00:59.075969|\n|3        |192.8.229.10   |14.998654  |2015-07-22 10:30:48.006039|2015-07-22 10:45:47.925306|\n|1        |182.69.49.201  |14.998471  |2015-07-22 10:46:13.619969|2015-07-22 11:01:13.528218|\n|3        |119.226.211.70 |14.998363  |2015-07-22 10:45:48.143338|2015-07-22 11:00:48.045104|\n|0        |223.176.4.226  |14.998362  |2015-07-22 10:30:48.486804|2015-07-22 10:45:48.388516|\n|5        |220.226.206.7  |14.998271  |2015-07-22 10:45:39.363623|2015-07-22 11:00:39.259912|\n|2        |117.198.171.90 |14.998198  |2015-07-22 10:49:44.802666|2015-07-22 11:04:44.694564|\n|0        |117.203.80.170 |14.998129  |2015-07-22 10:48:15.907488|2015-07-22 11:03:15.795228|\n|4        |203.143.186.45 |14.998012  |2015-07-22 10:46:48.198281|2015-07-22 11:01:48.07902 |\n|3        |14.141.45.138  |14.997978  |2015-07-22 10:46:45.784792|2015-07-22 11:01:45.663478|\n|1        |192.55.79.168  |14.997909  |2015-07-22 10:31:48.378757|2015-07-22 10:46:48.253323|\n|0        |120.56.178.102 |14.997554  |2015-07-22 10:45:54.044314|2015-07-22 11:00:53.897536|\n|4        |180.222.213.7  |14.997497  |2015-07-22 10:45:42.005456|2015-07-22 11:00:41.855302|\n|1        |203.16.165.129 |14.997409  |2015-07-22 10:30:52.459843|2015-07-22 10:45:52.304365|\n|5        |106.186.23.95  |14.997267  |2015-07-22 10:45:28.63101 |2015-07-22 11:00:28.467033|\n|1        |125.21.241.186 |14.996960  |2015-07-22 10:34:17.507722|2015-07-22 10:49:17.325345|\n|0        |117.218.65.155 |14.996843  |2015-07-22 10:46:47.039263|2015-07-22 11:01:46.84982 |\n|0        |168.235.197.111|14.996831  |2015-07-22 10:34:22.645469|2015-07-22 10:49:22.4553  |\n|0        |117.246.122.219|14.996675  |2015-07-22 10:33:51.692188|2015-07-22 10:48:51.492671|\n|4        |125.63.90.34   |14.996598  |2015-07-22 10:48:09.624532|2015-07-22 11:03:09.420406|\n|1        |175.101.67.58  |14.996490  |2015-07-22 10:45:54.945844|2015-07-22 11:00:54.735248|\n|2        |103.29.159.186 |14.996230  |2015-07-22 10:45:33.518098|2015-07-22 11:00:33.29191 |\n|0        |49.14.101.169  |14.996080  |2015-07-22 10:30:28.471544|2015-07-22 10:45:28.236329|\n|1        |202.65.154.58  |14.995875  |2015-07-22 10:30:42.717438|2015-07-22 10:45:42.469937|\n|0        |14.99.239.11   |14.995846  |2015-07-22 10:34:37.687316|2015-07-22 10:49:37.438102|\n|2        |117.206.171.41 |14.995736  |2015-07-22 10:48:40.062463|2015-07-22 11:03:39.806598|\n|0        |103.229.208.65 |14.995650  |2015-07-22 10:31:08.314048|2015-07-22 10:46:08.053051|\n|4        |121.58.175.128 |14.995538  |2015-07-22 10:30:35.08131 |2015-07-22 10:45:34.813574|\n|0        |122.169.109.88 |14.995414  |2015-07-22 10:47:25.881474|2015-07-22 11:02:25.606284|\n|1        |103.229.208.65 |14.995394  |2015-07-22 10:46:08.869216|2015-07-22 11:01:08.592859|\n|0        |122.169.141.4  |14.995352  |2015-07-22 10:30:34.830568|2015-07-22 10:45:34.551714|\n|3        |103.27.171.56  |14.995162  |2015-07-22 10:32:40.262702|2015-07-22 10:47:39.972438|\n|2        |193.194.132.74 |14.995101  |2015-07-22 10:30:38.107998|2015-07-22 10:45:37.814075|\n|4        |54.240.199.105 |14.995021  |2015-07-22 10:30:32.224528|2015-07-22 10:45:31.92577 |\n|1        |107.167.108.246|14.994949  |2015-07-22 10:31:38.533656|2015-07-22 10:46:38.23057 |\n|4        |182.74.142.2   |14.994845  |2015-07-22 10:47:50.323529|2015-07-22 11:02:50.014249|\n|1        |128.199.197.193|14.994800  |2015-07-22 10:30:30.950228|2015-07-22 10:45:30.638216|\n|0        |182.156.100.159|14.994299  |2015-07-22 10:46:26.243943|2015-07-22 11:01:25.901891|\n|1        |14.97.254.235  |14.994097  |2015-07-22 10:47:10.647479|2015-07-22 11:02:10.293302|\n|1        |122.172.239.101|14.993991  |2015-07-22 10:46:41.678852|2015-07-22 11:01:41.318322|\n|0        |117.194.106.106|14.993927  |2015-07-22 10:31:55.640382|2015-07-22 10:46:55.276003|\n|0        |106.219.31.42  |14.993803  |2015-07-22 10:49:21.268661|2015-07-22 11:04:20.896856|\n|0        |14.96.124.78   |14.993730  |2015-07-22 10:48:01.869003|2015-07-22 11:03:01.492828|\n|0        |220.225.238.173|14.993615  |2015-07-22 10:34:45.82542 |2015-07-22 10:49:45.44231 |\n|4        |14.141.35.115  |14.993256  |2015-07-22 10:45:34.134318|2015-07-22 11:00:33.729698|\n|0        |115.249.50.242 |14.993237  |2015-07-22 10:30:56.864475|2015-07-22 10:45:56.458692|\n|0        |182.70.66.80   |14.993145  |2015-07-22 10:31:59.876032|2015-07-22 10:46:59.464713|\n|1        |203.91.201.56  |14.992996  |2015-07-22 10:30:50.802886|2015-07-22 10:45:50.382627|\n|0        |123.136.214.228|14.992461  |2015-07-22 10:32:57.162768|2015-07-22 10:47:56.710409|\n|0        |128.199.94.210 |14.992396  |2015-07-22 10:32:43.761787|2015-07-22 10:47:43.305556|\n|2        |220.227.31.66  |14.992356  |2015-07-22 10:30:57.161622|2015-07-22 10:45:56.702979|\n|2        |103.4.125.25   |14.992241  |2015-07-22 10:30:28.647159|2015-07-22 10:45:28.181648|\n|1        |125.19.96.130  |14.991879  |2015-07-22 10:30:34.789175|2015-07-22 10:45:34.301911|\n|2        |210.212.229.98 |14.991725  |2015-07-22 10:46:46.233846|2015-07-22 11:01:45.737372|\n|1        |103.248.122.2  |14.991662  |2015-07-22 10:34:32.060706|2015-07-22 10:49:31.560397|\n|2        |66.249.71.110  |14.991615  |2015-07-22 10:30:46.110868|2015-07-22 10:45:45.607774|\n|1        |117.239.88.65  |14.991609  |2015-07-22 10:48:46.625455|2015-07-22 11:03:46.121972|\n|0        |114.143.137.182|14.991441  |2015-07-22 10:33:22.594918|2015-07-22 10:48:22.081395|\n|3        |164.164.144.9  |14.991390  |2015-07-22 10:46:16.179517|2015-07-22 11:01:15.662935|\n|2        |160.83.96.84   |14.991321  |2015-07-22 10:33:26.838668|2015-07-22 10:48:26.317915|\n|3        |202.12.83.44   |14.991271  |2015-07-22 10:34:28.867802|2015-07-22 10:49:28.344081|\n|0        |182.70.239.112 |14.991243  |2015-07-22 10:34:18.950131|2015-07-22 10:49:18.42472 |\n|0        |122.166.229.150|14.991045  |2015-07-22 10:33:53.093928|2015-07-22 10:48:52.55664 |\n|4        |59.161.164.4   |14.991042  |2015-07-22 10:46:28.750193|2015-07-22 11:01:28.21273 |\n|0        |182.19.8.82    |14.990944  |2015-07-22 10:32:18.540523|2015-07-22 10:47:17.997187|\n|1        |111.93.43.34   |14.990611  |2015-07-22 10:34:21.741869|2015-07-22 10:49:21.178525|\n|1        |107.167.108.101|14.990395  |2015-07-22 10:47:06.078543|2015-07-22 11:02:05.502269|\n|0        |103.243.52.127 |14.990063  |2015-07-22 10:31:27.944431|2015-07-22 10:46:27.348196|\n|4        |119.226.77.150 |14.990059  |2015-07-22 10:33:18.491832|2015-07-22 10:48:17.8954  |\n|1        |70.39.185.208  |14.990005  |2015-07-22 10:31:43.314539|2015-07-22 10:46:42.714832|\n|0        |14.139.126.167 |14.989934  |2015-07-22 10:33:09.679206|2015-07-22 10:48:09.075259|\n|0        |103.29.159.62  |14.989882  |2015-07-22 10:30:35.875368|2015-07-22 10:45:35.268309|\n|0        |203.99.195.195 |14.989636  |2015-07-22 10:33:43.701027|2015-07-22 10:48:43.079208|\n|0        |136.185.242.32 |14.989389  |2015-07-22 10:34:50.691328|2015-07-22 10:49:50.05467 |\n|0        |117.201.58.181 |14.989325  |2015-07-22 10:47:09.92103 |2015-07-22 11:02:09.280534|\n|3        |122.248.183.22 |14.989067  |2015-07-22 10:45:39.731669|2015-07-22 11:00:39.075659|\n|0        |112.79.37.154  |14.989034  |2015-07-22 10:45:42.336715|2015-07-22 11:00:41.67873 |\n|1        |122.15.203.173 |14.988849  |2015-07-22 10:48:45.447389|2015-07-22 11:03:44.778316|\n|0        |117.218.41.153 |14.988839  |2015-07-22 10:31:02.155616|2015-07-22 10:46:01.485927|\n|3        |125.63.73.178  |14.988359  |2015-07-22 10:49:18.819125|2015-07-22 11:04:18.120684|\n+---------+---------------+-----------+--------------------------+--------------------------+\nonly showing top 100 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585187369298_347797437","id":"20200322-182548_113204060","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:200","dateFinished":"2020-03-26T01:54:41+0000","dateStarted":"2020-03-26T01:54:28+0000"},{"text":"/*\nRangebin 0 - Number of session where session time is 0 mins ie basically user was seen only once in a session.We have such 22192 sessions \nRangebin 1 - User spent between > 0 and <=2.0 mins . We have such 66045 sessions\nRangebin 2 - User spent between > 2 and <=4.0 mins . We have such 15239 sessions\nRangebin 3 - User spent between > 4 and <=6.0 mins . We have such 3387 sessions\nand so on ...\n*/\nsessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(((max($\"ts\").cast(\"decimal(18,6)\")-min($\"ts\").cast(\"decimal(18,6)\"))/60.0).cast(\"decimal(18,6)\").as(\"sessiontime\"))\n              .groupBy(ceil($\"sessiontime\"/2.0).as(\"rangebin\")).count().orderBy($\"rangebin\").show(false)\n              \n            \n                    ","user":"anonymous","dateUpdated":"2020-03-26T01:54:41+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------+-----+\n|rangebin|count|\n+--------+-----+\n|0       |22192|\n|1       |66045|\n|2       |15239|\n|3       |3387 |\n|4       |982  |\n|5       |1166 |\n|6       |1205 |\n|7       |1491 |\n|8       |1668 |\n+--------+-----+\n\n"}]},"apps":[],"jobName":"paragraph_1585187369298_1003566392","id":"20200322-183019_342493410","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:201","dateFinished":"2020-03-26T01:54:55+0000","dateStarted":"2020-03-26T01:54:41+0000"},{"text":"sessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(max($\"ts\"),min($\"ts\"),((max($\"ts\").cast(\"decimal(18,6)\")-min($\"ts\").cast(\"decimal(18,6)\"))/60.0).cast(\"decimal(18,6)\").as(\"sessiontime\"))\n              .filter($\"sessiontime\" <=> 0).count()","user":"anonymous","dateUpdated":"2020-03-26T01:54:55+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res33: Long = 22192\n"}]},"apps":[],"jobName":"paragraph_1585187369299_1932793857","id":"20200322-201249_1362537945","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:202","dateFinished":"2020-03-26T01:55:08+0000","dateStarted":"2020-03-26T01:54:55+0000"},{"text":"sessioned_data.groupBy($\"sessionid\",$\"clientip\")\n              .agg(max($\"ts\"),min($\"ts\"),((max($\"ts\").cast(\"decimal(18,6)\")-min($\"ts\").cast(\"decimal(18,6)\"))/60.0).cast(\"decimal(18,6)\").as(\"sessiontime\"))\n              .filter($\"sessiontime\" > 2 and $\"sessiontime\" <= 4).count()","user":"anonymous","dateUpdated":"2020-03-26T01:55:08+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res34: Long = 15239\n"}]},"apps":[],"jobName":"paragraph_1585187369299_1611140914","id":"20200325-053054_1403792428","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:203","dateFinished":"2020-03-26T01:55:21+0000","dateStarted":"2020-03-26T01:55:08+0000"},{"user":"anonymous","dateUpdated":"2020-03-26T01:55:21+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1585187369299_1689120217","id":"20200325-051846_1654052253","dateCreated":"2020-03-26T01:49:29+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:204"}],"name":"approach3","id":"2F5TS8BFY","noteParams":{},"noteForms":{},"angularObjects":{},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}